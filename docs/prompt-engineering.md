# Prompt 工程记录

## 当前 System Prompt 版本: v1

### 核心结构
1. **角色定义**: Godot 4 专家开发者
2. **输出格式**: 严格 JSON，包含 project_name + files 数组
3. **约束规则**: 10 条关键规则确保生成质量
4. **技术参考**: 输入映射格式、场景文件格式、GDScript 语法规则
5. **游戏性规则**: 物理参数范围、碰撞检测、胜负条件

### 经验教训

#### 1. 必须明确物理参数范围
**问题**: AI 生成的跳跃高度不足以到达平台
**修复**: 在 prompt 中明确指定 gravity ~980.0, jump velocity -600 到 -700
**原则**: 不要让 AI 猜参数，给出经过验证的范围

#### 2. 避免依赖信号连接时序
**问题**: _ready() 中连接信号时，目标节点可能还没初始化
**修复**: 在 prompt 中推荐使用 call_group() 替代直接信号连接
**原则**: 引导 AI 使用更鲁棒的通信模式

#### 3. 输出格式防御性解析
**问题**: AI 偶尔输出 markdown 代码围栏包裹的 JSON
**修复**: 添加正则提取逻辑，先去除 ``` 包裹再解析 JSON
**原则**: 永远不要信任 AI 的输出格式，做防御性解析

#### 4. JSON 中的换行符
**问题**: .gd 和 .tscn 文件内容包含大量换行，JSON 字符串需要正确转义
**修复**: 模型自身处理得还可以，但解析后要验证文件可写入
**原则**: 写入文件后可以做基本的语法检查

### 待优化方向

- [ ] 按游戏类型分类 prompt（平台跳跃 vs 射击 vs RPG）
- [ ] 加入 few-shot examples（成功生成的案例作为参考）
- [ ] 修改模式的 prompt 需要更精确的差异描述
- [ ] 考虑用 XML 标签替代纯文本分隔上下文区块
